import os
import pandas as pd

# Chemin vers le répertoire contenant les fichiers malveillants
malware_directory_1 = 'C:\\Users\\cocol\\Documents\\HEH2023\\MachineLearning\\Projet\\heh-cybersecurity-2023-2024\\trainset\\trainset\\safe'
malware_directory_2 = 'C:\\Users\\cocol\\Documents\\HEH2023\\MachineLearning\\Projet\\heh-cybersecurity-2023-2024\\trainset\\trainset\\malware'

# Créer une liste pour stocker les résultats
results = []

# Fonction pour calculer le pourcentage de 0 et 1
def calculate_percentages(file_path):
    with open(file_path, 'rb') as binary_file:
        data = binary_file.read()
    percent_0 = data.count(b'\x00') / len(data)
    percent_1 = 1 - percent_0
    print(f"Le fichier au '{file_path}' a été lu avec succès.")
    return percent_0, percent_1

# Parcourir tous les fichiers du premier répertoire
for filename in os.listdir(malware_directory_1):
    if filename.endswith(".exe"):
        file_number = ''.join(filter(str.isdigit, filename))
        file_path = os.path.join(malware_directory_1, filename)
        percent_0, percent_1 = calculate_percentages(file_path)
        results.append([file_number, percent_0, percent_1])

# Parcourir tous les fichiers du deuxième répertoire
for filename in os.listdir(malware_directory_2):
    if filename.endswith(".exe"):
        file_number = ''.join(filter(str.isdigit, filename))
        file_path = os.path.join(malware_directory_2, filename)
        percent_0, percent_1 = calculate_percentages(file_path)
        results.append([file_number, percent_0, percent_1])

# Créer un DataFrame pandas à partir des résultats
columns = ['Name', '%0', '%1']
df = pd.DataFrame(results, columns=columns)

# Enregistrer le DataFrame dans un fichier CSV
csv_path = 'malware_results_percentages_combined.csv'
df.to_csv(csv_path, index=False)

print(f"Le fichier CSV '{csv_path}' a été créé avec succès.")
